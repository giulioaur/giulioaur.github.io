const GLOBALS={inputMap:{back:[66,27],select:[13],down:[83,40],left:[65,37],up:[87,38],right:[68,39]},loadingPercentage:0,projCurrIndex:-1,sliderData:{},textsToFit:document.getElementsByClassName("m-fit-text"),textIncrement:1,tip:["You can navigate the site also using your keyboard and your joypad."]};var menuGraph;const imageLoader={_images:[],loadImage(url){this._images.push(new Promise((resolve,reject)=>{const image=new Image;img.addEventListener("load",()=>resolve());img.addEventListener("error",()=>reject());image.url=url}))},async waitForLoading(){const areCorrectlyLoaded=await Promise.all(this._images).then(()=>true).catch(()=>false);return areCorrectlyLoaded}};(function startLoading(){const setTip=()=>{const tipBox=document.getElementById("m-loading-tip");if(tipBox){tipBox.textContent=GLOBALS.tip[Math.floor(Math.random()*GLOBALS.tip.length)];tipBox.classList.remove("m-black");return true}return false};const startAnimation=()=>{const image=document.getElementById("m-loading-image");if(image){const animation=TweenMax.to(image,3,{rotationY:360*3,ease:Power4.easeOut,onComplete:()=>{if(GLOBALS.loadingPercentage!=100){animation.restart()}}});return true}return false};let isTipCreated=false,startedAnimation=false;let loadingCheck=setInterval(()=>{if(!isTipCreated)tipCreated=setTip();if(!startedAnimation)startedAnimation=startAnimation();if(GLOBALS.loadingPercentage==100){document.getElementById("m-loading").style.display="none";clearInterval(loadingCheck);deferredEnterAnimation()}},200)})();function setupPage(){GLOBALS.loadingPercentage=30;dynamicGeneration();GLOBALS.loadingPercentage=50;menuGraph=new SM.Graph({shouldSave:true,logError:true,layoutMap:chooseLayout,playFirstAnimation:false});GLOBALS.loadingPercentage=70;bindAnimations();bindCustomEvents();GLOBALS.loadingPercentage=73;SM.input.bindInput(menuGraph,GLOBALS.inputMap);GLOBALS.loadingPercentage=87;fitTexts();GLOBALS.loadingPercentage=93;$(".m-slider").slider({create:createSliderData,slide:updateSliderElements});$(".m-slider").draggable();GLOBALS.loadingPercentage=95;imageLoader.waitForLoading();GLOBALS.loadingPercentage=100}function resizePage(){fitTexts(menuGraph.currentMenu.getElementsByClassName("m-fit-text"))}function chooseLayout(menu){const width=window.innerWidth||document.documentElement.clientWidth||document.getElementsByTagName("body")[0].clientWidth;const height=window.innerHeight||document.documentElement.clientHeight||document.getElementsByTagName("body")[0].clientHeight;const aspectRatio=height/width;return aspectRatio<=1?"main":"portrait"}function fitTexts(textsToResizes=null){if(!textsToResizes)textsToResizes=GLOBALS.textsToFit;for(let textToFit of textsToResizes){if(textToFit.offsetParent){const min=textToFit.dataset.minfont;const max=textToFit.dataset.maxfont;const parentHeight=textToFit.parentElement.offsetHeight;const parentWidth=textToFit.parentElement.offsetWidth;let currentSize=textToFit.style.fontSize?parseInt(textToFit.style.fontSize,10):20;currentSize*=parentHeight/textToFit.offsetHeight;currentSize=currentSize.clamp(min,max);textToFit.style.fontSize=currentSize+"px";const isLower=textToFit.offsetHeight<parentHeight?1:-1;while(currentSize&&(isLower>0?textToFit.offsetHeight<parentHeight:textToFit.offsetHeight>parentHeight)&&currentSize.isWithinRange(min,max)){currentSize+=GLOBALS.textIncrement*isLower;textToFit.style.fontSize=currentSize+"px"}if(isLower>0&&textToFit.offsetHeight>parentHeight&&currentSize.isWithinRange(min,max)){currentSize-=GLOBALS.textIncrement*isLower;textToFit.style.fontSize=currentSize+"px"}textToFit.style.fontSize=currentSize.clamp(min,max)+"px";textToFit.parentElement.style.overflowY=textToFit.offsetHeight>parentHeight?"scroll":"hidden"}}}function createSliderData(){let childs=this.children;GLOBALS.sliderData[this.id]={percentage:[],elems:[]};let elems=GLOBALS.sliderData[this.id].elems;let percentage=GLOBALS.sliderData[this.id].percentage;percentage.push(0);for(child of childs){if(child.classList.contains("m-slider-percentage"))percentage.push(percentage[percentage.length-1]+parseFloat(child.style.width))}percentage[0]=1;Array.from(document.getElementsByClassName("m-slider-section")).filter(ele=>ele.dataset.slider==this.id).forEach(ele=>{elems.push(ele);ele.style.display="none"});elems[0].style.display=""}function updateSliderElements(event,ui){let percentage=GLOBALS.sliderData[this.id].percentage;let currEle=percentage[0];if(currEle>1&&percentage[currEle-1]>=ui.value){let elems=GLOBALS.sliderData[this.id].elems;$(elems[currEle-2]).show();$(elems[currEle-1]).hide();--percentage[0];fitTexts(elems[currEle-2].getElementsByClassName("m-fit-text"))}else if(currEle<percentage.length-1&&percentage[currEle]<ui.value){let elems=GLOBALS.sliderData[this.id].elems;$(elems[currEle-1]).hide();$(elems[currEle]).show();++percentage[0];fitTexts(elems[currEle].getElementsByClassName("m-fit-text"))}}function bindCustomEvents(){skillsNavigation()}function skillsNavigation(){const skills=document.querySelectorAll("#m-skills #m-skills-trees .m-skills-skill.sm-item");for(let skill of skills){const changeItem=event=>{if(!event.detail.isMouseTrigger||event.detail.direction=="click"){const ev={dataTransfer:new DataTransfer,target:event.target.nodeName.toLowerCase()=="i"?event.target:event.target.getElementsByTagName("i")[0]};pickUpSkill(ev);ev.target=document.querySelector("#m-skills #m-skills-description #m-skills-icon-container > div");dropSkill(ev)}};skill.addEventListener("sm-activate",changeItem);skill.addEventListener("click",changeItem)}skillsPortrait()}function skillsPortrait(){$("#m-skills-carousel").on("slid.bs.carousel",function(){fitTexts();const ev={dataTransfer:new DataTransfer,target:document.querySelector("#m-skills-carousel .active i:first-of-type")};pickUpSkill(ev);ev.target=document.querySelector("#m-skills #m-skills-description #m-skills-icon-container > div");dropSkill(ev)});const items=document.querySelectorAll("#m-skills-carousel .carousel-item");for(let item of items){item.style.display="block";fitTexts(item.getElementsByClassName("m-fit-text"));item.style.display=""}}function pickUpSkill(ev){const style=window.getComputedStyle(ev.target.closest(".sm-item.sm-no-input"));ev.dataTransfer.setData("background",style.getPropertyValue("background-color"));ev.dataTransfer.setData("id",ev.target.parentElement.id)}function dropSkill(ev){const descrDiv=ev.target.closest("#m-skills-description");descrDiv.style.backgroundColor=ev.dataTransfer.getData("background");const oldDescr=descrDiv.querySelector("p.m-active");if(oldDescr)oldDescr.classList.remove("m-active");descrDiv.querySelector(`p#${ev.dataTransfer.getData("id")}-descr`).classList.add("m-active");const oldImg=descrDiv.querySelector("#m-skills-icon-container .m-active");if(oldImg)oldImg.classList.remove("m-active");descrDiv.querySelector(`#m-skills-icon-container #${ev.dataTransfer.getData("id")}-img`).classList.add("m-active");fitTexts(descrDiv.querySelectorAll(`p#${ev.dataTransfer.getData("id")}-descr`))}function dynamicGeneration(){generateProjects();generateSkills()}function generateSkills(){let skillRows=['<div class="col h-100 p-0"><div id="m-skills-programming" class="sm-item sm-no-input m-programming-skill w-100 h-100"><div class="w-100 m-skills-title"><h1 class="m-fit-text">Programming</h1></div>','<div class="col h-100 p-0"><div id="m-skills-tools" class="sm-item sm-no-input m-tools-skill w-100 h-100"><div class="w-100 m-skills-title"><h1 class="m-fit-text">Tools</h1></div>','<div class="col h-100 p-0"><div id="m-skills-knowledge" class="sm-item sm-no-input m-knowledge-skill w-100 h-100"><div class="w-100 m-skills-title"><h1 class="m-fit-text">Knowledge</h1></div>'];let skillDescr="";let skillImgs="";const rowNums=5;skillDescr+=`\n    <p id="m-skills-start-descr" class="m-fit-text m-active" data-minfont="13">\n        Drag the skill into the square to the left or click on it to read its description. It works also on mobile, even if the item seems not to be dragged.\n    </p>\n    `;for(let i=0;i<GLOBALS.skills.length;++i){const category=GLOBALS.skills[i];for(let j=0;j<rowNums;++j){const row=j<category.length?category[j]:null;skillRows[i]+='<div class="row justify-content-center w-100 m-0">';for(let k=0;row&&k<row.length;++k){skillRows[i]+=`\n                    <div id="m-skills-${row[k].name}" class="col-4 m-skills-skill sm-item h-100 p-0">\n                        <i draggable="true" ondragstart="pickUpSkill(event)" ${row[k].icon}></i>\n                    </div>\n                `;skillDescr+=`<p id="m-skills-${row[k].name}-descr" class="m-fit-text" data-minfont="13" data-maxfont="22">${row[k].description}</p>`;if(row[k].svg){skillImgs+=`<svg viewBox="0 0 128 128" id="m-skills-${row[k].name}-img">${row[k].svg}</svg>`}else if(row[k].img){skillImgs+=`<img id="m-skills-${row[k].name}-img" src="${row[k].img}">`;imageLoader.loadImage(row[k].img)}}skillRows[i]+="</div>"}}let allRows="";for(let i=0;i<skillRows.length;++i){skillRows[i]+="</div></div>";allRows+=skillRows[i]}document.querySelector("#m-skills > .sm-main-layout > #m-skills-trees").innerHTML=allRows;document.querySelector("#m-skills #m-skills-icon-container > div").innerHTML=skillImgs;document.querySelector("#m-skills > #m-skills-description > div:nth-child(2)").innerHTML=skillDescr;const icons=document.querySelectorAll("#m-skills > .sm-main-layout > #m-skills-trees i");for(let icon of icons)icon.classList.add("m-fit-text")}function generateProjects(){let list="";let descriptions="";for(project of GLOBALS.projects){list+=`\n            <div class="m-projects-row sm-item d-flex align-items-center">\n                ${project.title}\n            </div>\n        `;descriptions+=`\n            <div class="m-projects-container h-100 sm-redirect-blank-item" data-goto="${project.link}">\n                <div class="m-projects-banner d-flex align-items-center justify-content-center"\n                style="background-image: url('${project.screen}')">\n                    <h1>${project.extendedTitle}</h1>\n                </div>\n                <div class="m-projects-description">\n                    <p class="m-fit-text" data-maxfont="30" data-minfont="15">\n                        ${project.description}\n                    </p>\n                </div>\n            </div>\n        `;imageLoader.loadImage(project.screen)}document.querySelector("#m-projects > .sm-main-layout > .row > div:first-child").innerHTML=list;document.querySelector("#m-projects > .sm-main-layout > .row > div:nth-child(2)").innerHTML=descriptions}Number.prototype.clamp=function(min,max){const first=min?Math.max(this,min):this;return max?Math.min(first,max):first};Number.prototype.lowerWithinTreshold=function(limit,threshold){return this<=limit&&this>=limit-threshold};Number.prototype.isWithinRange=function(min,max){return(!min||this>=min)&&(!max||this<=max)};HTMLElement.prototype.fireEvent=function(eventName,bubbles=true,cancelable=true){let event=new Event(eventName,{view:window,bubbles:bubbles,cancelable:cancelable});this.dispatchEvent(event)};function bindAnimations(){itemHovering();projectsSelection()}function deferredEnterAnimation(){if(menuGraph.currentMenu.id=="m-projects")enterProjects(null,menuGraph.currentMenu)}function itemHovering(){let $items=$(".sm-item");$items.bind("sm-activate",function(event){let hover=this.querySelector(".m-item-hover");if(hover){hover.classList.add("m-active");TweenMax.to(hover,event.detail.direction!="restoreFocus"?.1:.001,{top:"-100%"})}});$items.bind("sm-deactivate",function(event){let hover=this.querySelector(".m-item-hover");if(hover)TweenMax.to(hover,event.detail.direction!="last"?.05:.001,{top:0,onComplete:()=>{hover.classList.remove("m-active")}})})}function projectsSelection(){const projectRows=document.getElementsByClassName("m-projects-row");const projects=document.getElementsByClassName("m-projects-container");if(projects.length==projectRows.length){for(let i=0;i<projectRows.length;++i){projects[i].style.display="none";projectRows[i].addEventListener(SM.CONST.inputActivationEvent,event=>{if(GLOBALS.projCurrIndex>=0&&GLOBALS.projCurrIndex<projects.length)projects[GLOBALS.projCurrIndex].style.display="none";projects[i].style.display="block";GLOBALS.projCurrIndex=i;fitTexts()})}}else{console.error("At least one project is not correctly setup.")}}function enterWithText(from,to,isBack){to.style.opacity=0;to.style.display="";fitTexts(to.getElementsByClassName("m-fit-text"));to.style.opacity=1}function enterWithRestore(from,to,isBack){enterWithText(from,to,isBack);if(from&&SM.input.wasKeyboard){SM.input.restoreFocus(to)}}function enterWithFirstFocus(from,to,isBack){enterWithText(from,to,isBack);if(from&&SM.input.wasKeyboard){SM.input.setFocusOn(to,0)}}function enterProjects(from,to,isBack){enterWithText(from,to,isBack);SM.input.restoreFocus(to)}function enterSkills(from,to,isBack){to.style.opacity=0;to.style.display="";fitTexts(to.querySelectorAll("i.m-fit-text"));to.style.opacity=1}function exitWithSaving(from,to,isBack){SM.input.saveFocus(from);from.style.display="none"}