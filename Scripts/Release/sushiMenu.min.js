var SM={CONST:{history:"sm-history",current:"sm-current",viewportId:"sm-viewport",menuClass:"sm-menu",itemClass:"sm-item",backItemClass:"sm-back-item",redirectItemClass:"sm-redirect-item",redirectBlankItemClass:"sm-redirect-blank-item",clearItemClass:"sm-clear-item",itemContainerClass:"sm-item-container",mainMenuId:"sm-main-menu",mainLayoutClass:"sm-main-layout",layoutClass:"sm-layout",currentLayoutClass:"sm-current-layout",layoutItemData:"item",gotoData:"goto",inAnimData:"smIn",outAnimData:"smOut"},Graph:class{constructor(t){if(this._saving=!t||void 0===t.shouldSave||t.shouldSave,this._layoutGetter=t&&t.layoutMap?t.layoutMap:()=>"main",this._shouldLog=!t||void 0===t.logError||t.logError,this._playFirstAnimation=!t||void 0===t.playFirstAnimation||t.playFirstAnimation,this._beforeAnimationFunc=[],this._afterAnimationFunc=[],this._observer=new MutationObserver(this.forceUpdateLayout.bind(this)),this._observer.observe(document.getElementById(SM.CONST.viewportId),{attributes:!0,childList:!0,subtree:!0}),this._setAttributes())if(this._buildGraph(),this._playFirstAnimation){const t=this._current.dataset[SM.CONST.inAnimData]?this._current.dataset[SM.CONST.inAnimData]:"SM.Animations.standardIn";this._playAnimation(t,this._current,!1)}else this._current.style.display=""}get currentMenu(){return this._current}_setAttributes(){return document.getElementById(SM.CONST.mainMenuId)?(this._saving&&"undefined"!=typeof Storage?(this._history=sessionStorage.getItem(SM.CONST.history)?sessionStorage.getItem(SM.CONST.history).split(","):[],this._current=document.getElementById(`${sessionStorage.getItem(SM.CONST.current)?sessionStorage.getItem(SM.CONST.current):SM.CONST.mainMenuId}`)):(this._history=[],this._current=document.getElementById(SM.CONST.mainMenuId)),this._nodes={},!0):(console.log(`No main menu declared (${SM.CONST.mainMenuId})`),!1)}_buildGraph(){const t=this,e=document.getElementById(SM.CONST.viewportId),s=e.querySelectorAll(`#${SM.CONST.viewportId} .${SM.CONST.menuClass}`);for(let e of s){const s=e.id;e.style.display="none",s?t._nodes[s]=e:this._logError("No id found",e),this._populateLayouts(e)}const i=e.getElementsByClassName(SM.CONST.itemClass);for(let e of i){const s=e.dataset[SM.CONST.gotoData],i=e.classList.contains(SM.CONST.redirectBlankItemClass);e.classList.contains(SM.CONST.redirectItemClass)||i?e.addEventListener("click",(()=>t._redirect(s,i))):e.addEventListener("click",(()=>t.goto(s,e.classList.contains(SM.CONST.backItemClass),e.classList.contains(SM.CONST.clearItemClass))))}const a=e.querySelectorAll(`.${SM.CONST.redirectItemClass}:not(.${SM.CONST.itemClass}), .${SM.CONST.redirectBlankItemClass}:not(.${SM.CONST.itemClass})`);for(let e of a){const s=e.classList.contains(SM.CONST.redirectBlankItemClass);e.addEventListener("click",(()=>t._redirect(e.dataset[SM.CONST.gotoData],s)))}}_populateLayouts(t){const e=t.querySelector(`.${SM.CONST.mainLayoutClass}`),s=t.querySelectorAll(`.${SM.CONST.layoutClass}:not(.${SM.CONST.mainLayoutClass})`);if(e){for(let t of s){const s=t.getElementsByClassName(SM.CONST.itemContainerClass);for(let t of s){const s=e.querySelector(`.${t.dataset[SM.CONST.layoutItemData]}`);s?t.appendChild(s.cloneNode(!0)):this._logError("No data-item attribute in container.",t)}t.style.display="none"}e.classList.add(SM.CONST.currentLayoutClass),this._setCorrectLayout(t)}else this._logError("Add a main layout to menu "+t.id)}_setCorrectLayout(t){const e=this._getLayoutName(t.id),s=t.querySelector(`.${SM.CONST.currentLayoutClass}`);if(!s.classList.contains(e)){const i=t.querySelector(`.${e}`);s.classList.remove(SM.CONST.currentLayoutClass),s.style.display="none",i.classList.add(SM.CONST.currentLayoutClass),i.style.display=""}}forceUpdateLayout(){this._setCorrectLayout(this._current)}goto(t,e=!1,s=!1){const i=this._history;let a,n,r=null;if(e){if(!(this._history&&this._history.length>0))return this._logError(`${this._current.id} cannot go back, no previous menu found.`),!1;{let e="";if(t)for(e=this._history.pop();this._history.length>0&&e!=t;e=this._history.pop());r=document.getElementById(`${e||this._history.pop()}`)}}else{const e=this._nodes[t];if(!e)return this._logError(`${t} is not a valid menu in ${this._current.id}`),!1;e!=this._current&&(this._history.push(this._current.id),r=e)}if(!r)return;this._setCorrectLayout(r),n=this._current.dataset[SM.CONST.outAnimData]?this._current.dataset[SM.CONST.outAnimData]:"SM.Animations.standardOut",a=r.dataset[SM.CONST.inAnimData]?r.dataset[SM.CONST.inAnimData]:"SM.Animations.standardIn";for(let t of this._beforeAnimationFunc)if(!t(this._current,r))return this._history=i,!1;const o=this._playAnimation(n,r,e),l=this._playAnimation(a,r,e),u=()=>{for(let t of this._afterAnimationFunc)t(this._current,r)};if(o||l){const t=o?l:o;(o||l).then(t?()=>{t.then(u)}:u)}else u();return this._current=r,s&&(this._history=[]),this._saveCurrentState(),!0}addDataCallback(t,e){e?this._beforeAnimationFunc.push(t):this._afterAnimationFunc.push(t)}_redirect(t,e){window.open(t,e?"_blank":"_self")}_playAnimation(t,e,s){let i=window;const a=t.split("."),n=a.pop();for(let t of a)i=i[t];if(i[n])return i[n].call(i,this._current,e,s);this._logError(`${n} not found.`)}_saveCurrentState(){this._saving&&"undefined"!=typeof Storage&&(sessionStorage.setItem(SM.CONST.history,this._history.toString()),sessionStorage.setItem(SM.CONST.current,this._current.id))}_getLayoutName(t){const e=`sm-${this._layoutGetter(t)}-layout`;return document.getElementById(t).querySelector(`.${e}`)?e:SM.CONST.mainLayoutClass}_logError(t){this._shouldLog&&(t instanceof Object?console.error.apply(this,t):console.error(t))}},Animations:class{static standardIn(t,e,s){e.style.display=""}static standardOut(t,e,s){t.style.display="none"}}};